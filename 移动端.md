# Android

## 基本概念

### 常识

创建于2003-10，现被 Google 收购。首个版本开始于 2008 。基于 Linux 内核。开源。

#### 系统架构

四层：

1. Linux 内核层，为硬件提供底层驱动，如显示、音频、蓝牙、电源等
2. 系统运行库层，通过 C/C++ 库提供特性支持。(早期 Dalvik 虚拟机，后期 ART运行环境)
3. 应用框架层。提供 API 。
4. 应用层。安装在手机上的应用程序。

![image-20220510142925781](img/image-20220510142925781.png)



#### 版本号

[官方介绍](http://developer.android.google.cn/about/dashboards)

![image-20220510143053644](img/image-20220510143053644.png)

![image-20220510143057566](img/image-20220510143057566.png)



#### 特点

四大组件：

- Activity 门面
- Service 后台
- BroadcastReceiver 广播
- ContentProvider 程序间共享数据

系统控件

SQLite 数据库

多媒体支持



### 开发环境

#### 安装

- JDK 即Java软件开发工具包
- Android SDK 开发工具包
- Android Studio 官方 IDE 

三者的集成： [下载地址](https://developer.android.google.cn/studio)

弹出无法访问 `add-on list` 就 cancel ，这是 Google 服务。

> 疑似 vscode 无法胜任



#### 使用

新建项目，选 empty activity ，语言选 Kotlin (或 Java) 。Minimum API level 是项目最低兼容版本，一般为 API 21。不支持 instance apps ，启用 AndroidX 。

一个安卓+手机的图标是启动Android模拟器。点击创建新的，例如Pixel。可以选择Android 10.0系统。

锤子图标按钮编译。播放图标按钮运行。



### 项目结构

#### 文件结构

点击最上方的Android区域切换项目结构模式为Project。

`.gradle` 和 `.idea` 是 studio 自动生成。

`app` 内是项目代码和资源。

- `build` 编译自动生成

- `libs` 第三方库

- `androidTest` 测试用例，自动化测试

- `java` Java 或 Kotlin 代码放置的地方

- `res` 图片等

  - `drawable` 图片
  - `layout` 布局
  - `values` 字符串
  - `mipmap` 应用图标，有很多是为了兼容性

- `AndroidManifest.xml` 项目配置文件

  定义所有四大组件的注册地方，添加权限声明等

- `test` Unit Test 测试用例

- `app.iml` 自动生成

- `build.gradle` 项目构建相关的配置

- `proguard-rules.pro` 指定项目代码的混淆规则，使得破解者难以阅读代码

`build` 是编译自动生成的文件

`gradle` 是 gradle wrapper 配置文件，默认启动，根据缓存决定是否联网下载 gradle 。如果改为离线模式 file-settings-build,exectuion,delpoyment-gradle

`build.gradle` 全局构建脚本

`gradle.properties` 配置文件

`gradlew` , `gradlew.bat` 执行命令，前者 linux/mac 后者 windows

`.iml` 是自动生成文件，意思是 IntelliJ IDEA

`local.properties` 指定本机 Android SDK 路径

`settings.gradle` 基本不用改



#### 代码结构

##### AndroidManifest.xml

在 `app\src\main\AndroidManifest.xml` 看到：

```xml
<?xml version="1.0" encoding="utf-8"?>
<manifest xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:tools="http://schemas.android.com/tools"
    package="com.example.helloworld">

    <application
		<activity
            android:name=".MainActivity"
            android:exported="true">
            <intent-filter>
                <action android:name="android.intent.action.MAIN" />

                <category android:name="android.intent.category.LAUNCHER" />
            </intent-filter>
        </activity>
  </application>

</manifest>
```

其中 `<activity android:name=".MainActivity"` 表示注册了 `MainActivity` ，后面的 action 和 category 表示点击应用图标首先启动这个 Activity 。



##### MainActivity

看到 `app\src\main\java\com\example\helloworld\MainActivity.kt` ，代码如下所示：

```kotlin
package com.example.helloworld

import androidx.appcompat.app.AppCompatActivity
import android.os.Bundle

class MainActivity : AppCompatActivity() {
    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_main)
    }
}
```

显然这是一个继承类。



##### activity_main.xml

布局文件。在 `app\src\main\res\layout\activity_main.xml` ，如下所示：

```xml
<?xml version="1.0" encoding="utf-8"?>
<androidx.constraintlayout.widget.ConstraintLayout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    tools:context=".MainActivity">

    <TextView
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:text="Hello World!"
        app:layout_constraintBottom_toBottomOf="parent"
        app:layout_constraintEnd_toEndOf="parent"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintTop_toTopOf="parent" />

</androidx.constraintlayout.widget.ConstraintLayout>
```

有一个文本框 TextView 看到了 `Hello World!`



##### string.xml

`res/values/strings.xml` 应用程序名

```xml
<resources>
    <string name="app_name">helloworld</string>
</resources>
```

引用方法：

- 代码 `R.string.app_name` 
- XML `@string/app_name`



#### Gradle

项目构建工具，基于 Groovy 的领域特定语言 GDL 。

暂时不看，有需要看书。

> ##### app/build.gradle



#### 日志工具

日志类 `android.util.Log`

优先级从低到高是：

- `Log.v()` verbose
- `.d` debug
- `.i` info
- `.w` warn
- `.e` error

调用，如在 `.kt` 里：`Log.d(tag, msg)` ，tag是字符串，一般是当前类名，第二个是信息。

查看：shift+f10运行，底部工具栏 android monitor 看到打印信息

Log 可以用过滤器。可以编辑一个。



## Kotlin语言

## 基本概念



## 基本语法